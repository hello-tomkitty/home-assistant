title: Lights
kiosk_mode:
  user_settings:
    - users:
        - tablet
      hide_account: true
views:
  - title: Lights - Switches
    path: lights-switches
    icon: mdi:light-switch
    type: panel
    cards:
      - type: vertical-stack
        cards:
          - type: custom:mod-card
            card_mod:
              style: |
                ha-card {
                  background: #ffc0cb !important;
                  border-radius: 14px !important;
                  box-shadow: none !important;
                  padding: 10px !important;
                }
            card:
              type: custom:layout-card
              layout_type: custom:grid-layout
              layout:
                grid-template-columns: repeat(auto-fit, minmax(140px, 220px))
                grid-gap: 10px
                justify-content: center
              cards:
                - type: button
                  name: All ON
                  icon: mdi:lightbulb-group
                  tap_action:
                    action: call-service
                    service: script.all_light_switches_on
                - type: button
                  name: All OFF
                  icon: mdi:lightbulb-group-off
                  tap_action:
                    action: call-service
                    service: script.all_light_switches_off
                - type: tile
                  entity: switch.presence_simulation_lights
                  name: Presence Simulation
                  icon: mdi:airplane
                  tap_action:
                    action: toggle
                  hold_action:
                    action: more-info
          - type: custom:mod-card
            card_mod:
              style: |
                ha-card {
                  background: #ffc0cb !important; /* soft pink */
                  border-radius: 14px !important;
                  box-shadow: none !important;
                  padding: 10px !important;
                }

                vertical-stack$ ha-card,
                layout-card$ ha-card {
                  background: transparent !important;
                  box-shadow: none !important;
                }

                /* Keep tiles normal */
                hui-tile-card$ ha-card,
                tile-card$ ha-card {
                  background: var(--ha-card-background, var(--card-background-color, var(--primary-background-color))) !important;
                  box-shadow: var(--ha-card-box-shadow, var(--paper-card-box-shadow, none)) !important;
                }
            card:
              type: custom:auto-entities
              card:
                type: vertical-stack
              card_param: cards
              filter:
                template: >
                  {%- set entities =
                  state_attr('sensor.light_switch_entity_list','entities') or []
                  -%}

                  {%- set area_icons = {
                    "Anuradha's Room": "mdi:human-child",
                    "Attic stairs": "mdi:stairs",
                    "Attic Store Room": "mdi:home-roof",
                    "Back Garden House": "mdi:bike",
                    "Basement Corridor": "mdi:home-floor-negative-1",
                    "Bathroom": "mdi:bathtub",
                    "Bedroom": "mdi:bed",
                    "Downstairs Corridor": "mdi:home-floor-0",
                    "Entryway": "mdi:door",
                    "Front Garden House": "mdi:trash-can",
                    "Garage": "mdi:garage",
                    "Garden Shed": "mdi:shovel",
                    "Guest Toilet": "mdi:toilet",
                    "Heating Room": "mdi:heating-coil",
                    "Ironing Room": "mdi:iron-board",
                    "Kitchen": "mdi:stove",
                    "Laundry Room": "mdi:washing-machine",
                    "Living Room": "mdi:television",
                    "Maheeka's Office": "mdi:face-woman",
                    "Server Room": "mdi:server",
                    "Staircase Corner": "mdi:stairs-down",
                    "Store Room": "mdi:baguette",
                    "Tom's Office": "mdi:face-man",
                    "Upstairs Corridor": "mdi:home-floor-1"
                  } -%}

                  {%- set floor_levels = {
                    "Garden": -2,
                    "Basement": -1,
                    "Ground Floor": 0,
                    "First Floor": 1,
                    "Attic": 2
                  } -%}

                  {%- set floor_icons = {
                    "Garden": "mdi:tree",
                    "Basement": "mdi:home-floor-negative-1",
                    "Ground Floor": "mdi:home-floor-0",
                    "First Floor": "mdi:home-floor-1",
                    "Attic": "mdi:home-roof"
                  } -%}

                  {%- set header_style = "
                    ha-card {
                      background: #6a1b9a !important;
                      --ha-card-background: #6a1b9a !important;
                      color: white !important;
                      border-radius: 10px !important;
                      box-shadow: none !important;
                      padding: 2px 8px !important;
                    }
                    ha-markdown {
                      font-size: 12px !important;
                      line-height: 1.0 !important;
                    }
                    p { margin: 0 !important; }
                    ha-icon {
                      color: white !important;
                      --mdc-icon-size: 14px;
                      vertical-align: middle;
                    }
                  " -%}

                  {%- set floor_container_style = "
                    ha-card {
                      background: #ff3ea5 !important; /* bright pink floor container */
                      border-radius: 14px !important;
                      box-shadow: none !important;
                    }
                  " -%}

                  {%- set ns = namespace(items=[]) -%} {%- for e in entities -%}
                    {%- set floor = floor_name(e) -%}
                    {%- set area  = area_name(e) -%}
                    {%- if floor and area -%}
                      {%- set lvl = floor_levels.get(floor, 999) -%}
                      {%- set ns.items = ns.items + [{'floor': floor, 'level': lvl, 'area': area, 'entity': e}] -%}
                    {%- endif -%}
                  {%- endfor -%}

                  {%- set ns.items = ns.items
                    | sort(attribute='entity')
                    | sort(attribute='area')
                    | sort(attribute='level', reverse=true) -%}

                  {%- set out = namespace(cards=[], prev_level=none,
                  prev_floor='', floor_tiles=[]) -%}

                  {%- for item in ns.items -%}
                    {%- if out.prev_level is none -%}
                      {%- set out.prev_level = item.level -%}
                      {%- set out.prev_floor = item.floor -%}
                    {%- endif -%}

                    {%- if item.level != out.prev_level -%}
                      {%- if (out.floor_tiles | length) > 0 -%}
                        {%- set ficon = floor_icons.get(out.prev_floor, "mdi:home") -%}
                        {%- set header = "<ha-icon icon='" ~ ficon ~ "'></ha-icon>&nbsp;&nbsp;**" ~ out.prev_floor ~ "**" -%}
                        {%- set out.cards = out.cards + [{
                          "type": "custom:stack-in-card",
                          "mode": "vertical",
                          "card_mod": { "style": floor_container_style },
                          "cards": [
                            { "type": "markdown", "content": header, "card_mod": { "style": header_style } },
                            {
                              "type": "custom:layout-card",
                              "layout_type": "custom:grid-layout",
                              "layout": {
                                "grid-template-columns": "repeat(auto-fit, minmax(150px, 220px))",
                                "grid-gap": "8px",
                                "justify-content": "center"
                              },
                              "cards": out.floor_tiles
                            }
                          ]
                        }] -%}
                      {%- endif -%}

                      {%- set out.floor_tiles = [] -%}
                      {%- set out.prev_level = item.level -%}
                      {%- set out.prev_floor = item.floor -%}
                    {%- endif -%}

                    {%- set friendly = state_attr(item.entity, "friendly_name") or item.entity -%}
                    {%- set aicon = area_icons.get(item.area, "mdi:lightbulb") -%}
                    {%- set out.floor_tiles = out.floor_tiles + [{
                      "type": "tile",
                      "entity": item.entity,
                      "name": friendly,
                      "icon": aicon,
                      "tap_action": {"action": "toggle"},
                      "hold_action": {"action": "more-info"}
                    }] -%}
                  {%- endfor -%}

                  {%- if (out.floor_tiles | length) > 0 -%}
                    {%- set ficon = floor_icons.get(out.prev_floor, "mdi:home") -%}
                    {%- set header = "<ha-icon icon='" ~ ficon ~ "'></ha-icon>&nbsp;&nbsp;**" ~ out.prev_floor ~ "**" -%}
                    {%- set out.cards = out.cards + [{
                      "type": "custom:stack-in-card",
                      "mode": "vertical",
                      "card_mod": { "style": floor_container_style },
                      "cards": [
                        { "type": "markdown", "content": header, "card_mod": { "style": header_style } },
                        {
                          "type": "custom:layout-card",
                          "layout_type": "custom:grid-layout",
                          "layout": {
                            "grid-template-columns": "repeat(auto-fit, minmax(150px, 220px))",
                            "grid-gap": "8px",
                            "justify-content": "center"
                          },
                          "cards": out.floor_tiles
                        }
                      ]
                    }] -%}
                  {%- endif -%}

                  {{ out.cards | tojson }}
